<!DOCTYPE HTML>
<html>
    <head>
        <title>View {{data['check']}}</title>
        <link rel='stylesheet' href='static/css/style.css'>
        <link href="https://www.firmus.com.sg/wp-content/uploads/2022/03/SK_196_edited_sq_trans-line.png" rel='icon'>
    </head>

    <body>
        {% include 'header.html' %}
        <div class='container-1'>
            <h1>{{data['check'].upper()}} {{data['specific'].upper()}}</h1>
            <div class='container-box'>
                <span>Search: </span>
                <input placeholder="Search" type='text' class='search' oninput="search(this.value)">
                <span>Search by: </span>
                <select id="select">
                    {% for count, key in data['header'].items() %}
                    <option value="{{count}}">
                        {{key.title()}}
                    </option>
                    {% endfor %}
                </select>
                <br><br>
                <table id='table'>
                    <tr>
                    {% for count, key in data['header'].items() %}
                            <td class='table-header' onclick='sort({{count}}, "caret-{{key}}")'>
                                <p id='{{key}}'>
                                    {{key.title()}} <i class="downcaret" id="caret-{{key}}" style="border-color: white"></i>
                                </p>
                            </td>
                    {% endfor %}
                    </tr>
                    {% for record in data['data'] %}
                        <tr id="{{record[data['main_header']]}}" onclick=go_to_url("{{record[data['main_header']]}}")>
                            {% for value in record.values() %}
                                <td>
                                    <p class='table-content'>{{value}}</p>
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
        {% include 'footer.html' %}
    </body>
    <script>
        function go_to_url(value) {
            window.location = "/view_{{data['check']}}?" + value;
        };
        
        function search(key) { /** Linear search **/
            var table, rows, search_by;
            search_by = document.getElementById('select').value; /**Value for which column to search by**/
            table = document.getElementById('table');
            rows = table.rows;
            for (i = 1; i < (rows.length); i++) { /**Iterates through table content**/
                text = rows[i].getElementsByClassName("table-content")[search_by].innerHTML;
                
                if (!(text.toLowerCase().includes(key.toLowerCase()))) { /**Checks if search value is in table content**/
                    
                    rows[i].style.visibility = "collapse"; /**Collapses table row if does not fit search **/
                    
                } else if (rows[i].style.visibility == "collapse") {
                    
                    rows[i].style.visibility = "visible"; /**Opens table row if previously collapsed and fits search **/
                };
            };
        };
        
        function sort(n, key) { /** Bubble Sort **/
            var table, rows, before, after, no_swaps, coll;
            coll = document.getElementsByClassName('downcaret');
            
            for (i = 0; i < coll.length; i++) {
                coll[i].style.transform = "rotate(45deg)"
            };
            
            document.getElementById(key).style.transform = "rotate(-135deg) translateX(-3px) translateY(-3px)";

            table = document.getElementById('table');
            
            for (i = 1; i < (table.rows.length - 1); i++) {
                rows = table.rows;
                no_swaps = true;
                
                for (e = 1; e < (table.rows.length - i); e++) {
                    
                    before = rows[e].getElementsByTagName("P")[n].innerHTML;
                    after = rows[e + 1].getElementsByTagName("P")[n].innerHTML;

                    
                    if (!isNaN(Number(before))) { /** Sort by number is possible **/
                        
                        before = Number(before);
                        after = Number(after);
                        if (before > after) {
                            no_swaps = false;
                            rows[e].parentNode.insertBefore(rows[e + 1], rows[e]);
                        };
                        
                    } else if (before.toLowerCase() > after.toLowerCase()) { /** sort by character **/
                            no_swaps = false;
                            rows[e].parentNode.insertBefore(rows[e + 1], rows[e]);

                    };
                };

                if (no_swaps) {
                  break;  
                };
            };
        };
    </script>
    
</html>